// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String
  createdAt     DateTime  @default(now())
  applications  Application[]
  companies     Company[]
  documents     Document[]
}

model Application {
  id                String            @id @default(cuid())
  position          String
  status            ApplicationStatus
  appliedAt         DateTime?
  interviewAt       DateTime?
  deadline          DateTime?
  notes             String?
  headhunterProposals String?         // Propositions reçues via des cabinets / chasseurs
  announcementLink  String?           // Lien de l'annonce
  productType       String?           // Type de produit que l'entreprise vend
  salary            String?           // Salaire (ex: "40k-50k", "Non communiqué")
  benefits          String?           // Avantages
  publisherType     PublisherType?    // Cabinet ou Entreprise
  platform          String?           // Plateforme (LinkedIn, Indeed, etc.)
  userId            String
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  companyId         String
  company           Company           @relation(fields: [companyId], references: [id], onDelete: Cascade)
  documents         Document[]
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
}

model Company {
  id            String    @id @default(cuid())
  name          String
  website       String?
  industry      String?
  size          String?
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  applications  Application[]
  contacts      Contact[]
  createdAt     DateTime  @default(now())
}

model Contact {
  id            String    @id @default(cuid())
  name          String
  email         String?
  phone         String?
  position      String?
  companyId     String
  company       Company   @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdAt     DateTime  @default(now())
}

model Document {
  id            String    @id @default(cuid())
  name          String
  type          DocumentType
  url           String
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  applicationId String?
  application   Application? @relation(fields: [applicationId], references: [id], onDelete: SetNull)
  createdAt     DateTime  @default(now())
}

enum ApplicationStatus {
  TO_APPLY
  APPLIED
  INTERVIEW
  REJECTED
  ACCEPTED
}

enum PublisherType {
  CABINET    // Cabinet de recrutement
  ENTREPRISE // Entreprise
}

enum DocumentType {
  CV
  COVER_LETTER
  OTHER
}
